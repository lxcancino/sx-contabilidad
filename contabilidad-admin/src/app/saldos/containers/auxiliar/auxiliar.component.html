<div layout class="container">
  <mat-card flex="80" *ngIf="!selected">
    <div layout layout-align="start center" class="pad-top pad-left pad-right">
      <sx-cuenta-contable-field
        [formControl]="control"
        [required]="false"
        flex="70"
      >
      </sx-cuenta-contable-field>
      <span flex layout>
        <span class="pad-left">Saldo Inicial</span>
        <span flex class="pad-left">{{ saldo?.saldoInicial | currency }}</span>
      </span>
    </div>
    <div class="table-container" layout="column">
      <ng-container>
        <td-data-table
          [data]="data"
          [columns]="displayColumns"
          [clickable]="true"
          (rowClick)="drillDown($event)"
        >
          <ng-template tdDataTableTemplate="fecha" let-value="value">
            <span>{{ value | date: 'dd/MM/yyyy' }}</span>
          </ng-template>
          <ng-template tdDataTableTemplate="debe" let-value="value">
            <span>{{ value | currency }}</span>
          </ng-template>
          <ng-template tdDataTableTemplate="haber" let-value="value">
            <span>{{ value | currency }}</span>
          </ng-template>
          <ng-template tdDataTableTemplate="acumulado" let-value="value">
            <span>{{ value | currency }}</span>
          </ng-template>
        </td-data-table>
        <div
          layout
          layout-align="start center"
          class="pad-top pad-left pad-right"
        >
          <span flex="70"></span>
          <span flex layout>
            <span class="pad-left">Saldo Final</span>
            <span flex class="pad-left">{{
              saldo?.saldoFinal | currency
            }}</span>
          </span>
        </div>
      </ng-container>
    </div>
  </mat-card>

  <mat-card *ngIf="selected" flex>
    <div layout layout-align="start center" class="pad-sm">
      <span class="push-left-sm">
        <span class="mat-title"
          >{{ cuenta.clave }} {{ cuenta.descripcion }}
          <span *ngIf="cuenta?.padre"> ({{ cuenta.padre.descripcion }}) </span>
        </span>
      </span>
      <span flex></span>
      <ng-content select=".info" flex></ng-content>
      <span flex></span>
      <button mat-button (click)="selected = null">Regresar</button>
      <button mat-button (click)="loadDetalle()">Detalle</button>
      <button
        mat-button
        mat-icon-button
        (click)="detallesGrid.exportData(cuenta)"
        matTooltip="Exportar a CSV"
      >
        <mat-icon color="primary">file_download</mat-icon>
      </button>
    </div>
    <mat-divider></mat-divider>
    <div>
      <ng-container>
        <td-data-table
          [data]="selected.data"
          [columns]="detailColumns"
          [selectable]="true"
          [multiple]="true"
          [clickable]="false"
          [(ngModel)]="selectedRows"
          (onRowSelect)="onDetailSelected($event)"
          (onSelectAll)="onAllDetailSelected($event)"
        >
          <ng-template tdDataTableTemplate="fecha" let-value="value">
            <span>{{ value | date: 'dd/MM/yyyy' }}</span>
          </ng-template>
          <ng-template tdDataTableTemplate="debe" let-value="value">
            <span>{{ value | currency }}</span>
          </ng-template>
          <ng-template tdDataTableTemplate="haber" let-value="value">
            <span>{{ value | currency }}</span>
          </ng-template>
        </td-data-table>
        <mat-divider></mat-divider>
        <div>
          <sx-polizadet-table
            [partidas]="detalles"
            #detallesGrid
          ></sx-polizadet-table>
        </div>
      </ng-container>
    </div>
  </mat-card>
</div>
